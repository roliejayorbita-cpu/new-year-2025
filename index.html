<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>2025: Rose & Rolie Archive</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&family=Poppins:wght@300;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg: #0d1117;
        --white: #ffffff;
        --tape-color: rgba(255, 255, 255, 0.2);
      }

      body {
        background-color: var(--bg);
        margin: 0;
        height: 100dvh;
        width: 100vw;
        overflow: hidden;
        font-family: "Poppins", sans-serif;
        touch-action: none; /* Crucial for custom touch logic */
        -webkit-user-select: none;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
      }

      #desk {
        width: 100%;
        height: 100%;
        position: relative;
        background-image: radial-gradient(#333 1px, transparent 1px);
        background-size: 30px 30px;
      }

      /* Photo Entrance Animation */
      @keyframes photoDrop {
        0% {
          transform: translateY(-100vh) rotate(0deg);
          opacity: 0;
        }
        100% {
          transform: translateY(0) rotate(var(--r));
          opacity: 1;
        }
      }

      .polaroid {
        position: absolute;
        perspective: 1000px;
        cursor: grab;
        z-index: 10;
        transition: transform 0.3s ease;
        animation: photoDrop 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275)
          backwards;
      }

      /* Washi Tape Effect */
      .polaroid::before {
        content: "";
        position: absolute;
        top: -10px;
        left: 50%;
        transform: translateX(-50%) rotate(-2deg);
        width: 50px;
        height: 18px;
        background: var(--tape-color);
        backdrop-filter: blur(2px);
        z-index: 100;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .polaroid-inner {
        position: relative;
        width: 100%;
        height: 100%;
        transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        transform-style: preserve-3d;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        pointer-events: none; /* Parent catches tap */
      }

      .polaroid.flipped .polaroid-inner {
        transform: rotateY(180deg);
      }

      .front,
      .back {
        position: absolute;
        width: 100%;
        height: 100%;
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
        background: var(--white);
        padding: 10px 10px 35px 10px;
        box-sizing: border-box;
        border-radius: 2px;
        overflow: hidden;
      }

      .front img {
        width: 100%;
        height: auto;
        display: block;
        pointer-events: none;
      }

      .caption {
        position: absolute;
        bottom: 8px;
        left: 0;
        width: 100%;
        text-align: center;
        color: #333;
        font-size: 11px;
        font-weight: bold;
      }

      .back {
        transform: rotateY(180deg);
        display: flex;
        align-items: flex-start; /* Ensure long text starts at top */
        justify-content: center;
        background: #fdfdfd;
        border: 1px solid #ddd;
      }

      .back-text {
        font-family: "Caveat", cursive;
        color: #444;
        font-size: 18px;
        text-align: center;
        line-height: 1.3;
        padding: 20px 15px;
        width: 100%;
        max-height: 100%;
        overflow-y: auto;
        pointer-events: auto; /* Catch scroll events */
        box-sizing: border-box;
        -webkit-overflow-scrolling: touch;
      }

      .back-text::-webkit-scrollbar {
        display: none;
      }

      /* Bobbing Scroll Arrow */
      .scroll-arrow {
        position: absolute;
        bottom: 5px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 20px;
        color: #aaa;
        pointer-events: none;
        display: none;
        animation: bob 1.5s infinite;
        z-index: 1001;
      }

      @keyframes bob {
        0%,
        100% {
          bottom: 5px;
          opacity: 0.3;
        }
        50% {
          bottom: 10px;
          opacity: 1;
        }
      }

      .zoomed {
        transform: scale(1.8) !important;
        z-index: 9999 !important;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
      }

      .instruction {
        position: absolute;
        top: 15px;
        width: 100%;
        text-align: center;
        color: rgba(255, 255, 255, 0.3);
        font-size: 10px;
        letter-spacing: 1px;
        text-transform: uppercase;
        pointer-events: none;
      }

      .milestone-footer {
        position: fixed;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        color: rgba(255, 255, 255, 0.2);
        font-size: 9px;
        letter-spacing: 2px;
        text-transform: uppercase;
        pointer-events: none;
        z-index: 5;
      }
    </style>
  </head>
  <body>
    <audio
      id="flip-sound"
      src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"
      preload="auto"
    ></audio>

    <div id="desk">
      <div class="instruction">
        Tap to Flip â€¢ Hold to Zoom â€¢ Drag to Arrange
      </div>
    </div>

    <script>
      const memoryFiles = [
        {
          file: "memories/1v1.jpg",
          caption: "1v1 Virtual Inuman ðŸ»",
          note: "I love this picture of us! We literally had a mutual agreement to watch a movie and drink a whole bottle of soju HAHAHAHAH when ulit? ðŸ¤ª",
        },
        {
          file: "memories/bday_cake.jpg",
          caption: "Birthday Cake? ðŸŽ‚",
          note: "Even though technically this wasn't for me, you got me emotional with this surprise cake tung birthday nako you made it that much more special babii, Thank youuu â¤ï¸",
        },
        {
          file: "memories/bday_gift.jpg",
          caption: "Birthday Gift ðŸŽ",
          note: "For my birthday you got me this gift. I was really touched that you bought a gift for me even though you didn't need to. â¤ï¸",
        },
        {
          file: "memories/fav.jpg",
          caption: "Favorite Picture of you ðŸ“¸",
          note: "Out of all the pictures I have of you, this one is my favorite. You look so happy and I really love the way you're smiling in this photo. ðŸ¥°",
        },
        {
          file: "memories/fav_whole.jpg",
          caption: "Favorite na Buong Katawan ðŸ“¸",
          note: "This is my favorite full-body picture of you. You look so confident and beautiful. Also the fact that we matched this outfit together just made it more meaningful.ðŸ˜",
        },
        {
          file: "memories/fav2.0.jpg",
          caption: "Close Second favorite ðŸ“¸",
          note: "You literally just gave me this picture today and I already fell in love with it. You look so cute here babiii! ",
        },
        {
          file: "memories/feedme.jpg",
          caption: "Feed Me!",
          note: "This picture made me melt the first time you sent it to me. You are so cute gina suboan ko nimoo!ðŸ˜",
        },
        {
          file: "memories/hangover.jpg",
          caption: "Hangover BreakfastðŸ˜µ",
          note: "I really wanted to take care of you that morning after you got drunk. Seeing you like that made me want to be there for you even more. â¤ï¸",
        },
        {
          file: "memories/heart.jpg",
          caption: "My Heart â¤ï¸",
          note: "It took us a few minutes to finally get the perfect heart shape. I want a polaroid copy of this one babii ðŸ˜",
        },
        {
          file: "memories/madam.jpg",
          caption: "Hello Madam ðŸ’…",
          note: "You gave me this the other day. Ganahan kaayo ko sa hair nimo. You look gorgeous here babii! ðŸ¤©",
        },
        {
          file: "memories/movie.jpg",
          caption: "Movie Date ðŸŽ¬",
          note: "Remember this day? We were trying to finish this series but we couldn't? I love watching anything with you babii â¤ï¸",
        },
        {
          file: "memories/quirky.jpg",
          caption: "Quirkyy Rosee ðŸ¤ª",
          note: "I love how you're not afraid to show me your quirky and playful side. Thank you for agreeing to my requests babii â¤ï¸",
        },
        {
          file: "memories/sleepfirst.jpg",
          caption: "You Slept First ðŸ˜´",
          note: "I was really happy you could sleep knowing that you trust me enough to just fall asleep on call. I love you so much babii â¤ï¸",
        },
        {
          file: "memories/receipts.jpg",
          caption: "You Saved Them ðŸ¥°",
          note: "I really appreciate that you value the things I give you babii. You make me feel special and loved. Thank youuu â¤ï¸",
        },
        {
          file: "memories/sorry.jpg",
          caption: "I'm Sorry ðŸ˜”",
          note: "First time I bought you food that had a note. Pala away man gud kaayo ka Rolie ba HAHAHAHA I hope I made it up to you babii â¤ï¸",
        },
        {
          file: "memories/teddy.jpg",
          caption: "Teddy ðŸ§¸",
          note: "Merry Christmas babii! I hope you liked your teddy bear. I wanted to give you something cuddly to remind you of me. I love you â¤ï¸",
        },
      ];

      const desk = document.getElementById("desk");
      const flipSound = document.getElementById("flip-sound");
      let highestZ = 100;

      memoryFiles.forEach((m, index) => {
        const card = document.createElement("div");
        card.className = "polaroid";

        const img = new Image();
        img.src = m.file;

        img.onload = () => {
          const canvas = document.createElement("canvas");
          const ctx = canvas.getContext("2d");
          const MAX_WIDTH = 800;
          let width = img.width;
          let height = img.height;

          if (width > MAX_WIDTH) {
            height *= MAX_WIDTH / width;
            width = MAX_WIDTH;
          }

          canvas.width = width;
          canvas.height = height;
          ctx.drawImage(img, 0, 0, width, height);
          const compressedSrc = canvas.toDataURL("image/jpeg", 0.7);

          const baseWidth = 170;
          const ratio = height / width;
          const calculatedHeight = baseWidth * ratio + 45;

          card.style.width = `${baseWidth}px`;
          card.style.height = `${calculatedHeight}px`;

          const randRot = Math.random() * 24 - 12;
          card.style.setProperty("--r", `${randRot}deg`);
          card.style.animationDelay = `${index * 0.15}s`;

          card.innerHTML = `
                    <div class="polaroid-inner">
                        <div class="front">
                            <img src="${compressedSrc}">
                            <div class="caption">${m.caption}</div>
                        </div>
                        <div class="back">
                            <div class="back-text">${m.note}</div>
                        </div>
                    </div>
                `;

          const randX = Math.random() * (window.innerWidth - baseWidth - 20);
          const randY =
            80 + Math.random() * (window.innerHeight - calculatedHeight - 160);

          card.style.left = `${randX}px`;
          card.style.top = `${randY}px`;
          card.style.transform = `rotate(${randRot}deg)`;

          setupLogic(card, randX, randY, randRot);
          desk.appendChild(card);
        };
      });

      function setupLogic(card, x, y, rot) {
        let curX = x,
          curY = y;
        let startX, startY;
        let startTime, zoomTimeout;
        let hasMoved = false;

        const arrow = document.createElement("div");
        arrow.className = "scroll-arrow";
        arrow.innerHTML = "â–¾";
        card.querySelector(".back").appendChild(arrow);

        const playFlipSound = () => {
          flipSound.currentTime = 0;
          flipSound.play().catch(() => {});
        };

        const checkScroll = () => {
          const textContainer = card.querySelector(".back-text");
          if (textContainer.scrollHeight > textContainer.clientHeight) {
            arrow.style.display = "block";
            arrow.style.opacity = "1";
          }
        };

        const toggleFlip = () => {
          card.classList.toggle("flipped");
          playFlipSound();
          if (card.classList.contains("flipped")) {
            setTimeout(checkScroll, 600);
          } else {
            arrow.style.display = "none";
          }
        };

        card
          .querySelector(".back-text")
          .addEventListener("scroll", function () {
            arrow.style.opacity = "0";
            arrow.style.transition = "opacity 0.5s";
          });

        const onStart = (e) => {
          // Allow scrolling on the back text without triggering drag
          if (e.target.classList.contains("back-text")) return;

          if (e.type === "touchstart") e.preventDefault();
          card.style.zIndex = ++highestZ;
          const p = e.touches ? e.touches[0] : e;
          startX = p.clientX - curX;
          startY = p.clientY - curY;
          startTime = Date.now();
          hasMoved = false;

          zoomTimeout = setTimeout(() => {
            if (!hasMoved) card.classList.add("zoomed");
          }, 500);
        };

        const onMove = (e) => {
          // Lock drag if card is flipped to allow for scrolling notes
          if (card.classList.contains("flipped")) return;

          const p = e.touches ? e.touches[0] : e;
          const dx = p.clientX - (curX + startX);
          const dy = p.clientY - (curY + startY);

          if (Math.abs(dx) > 10 || Math.abs(dy) > 10) {
            hasMoved = true;
            clearTimeout(zoomTimeout);
            card.classList.remove("zoomed");
          }

          if (hasMoved) {
            curX = p.clientX - startX;
            curY = p.clientY - startY;
            card.style.left = `${curX}px`;
            card.style.top = `${curY}px`;
          }
        };

        const onEnd = () => {
          clearTimeout(zoomTimeout);
          const duration = Date.now() - startTime;
          if (!hasMoved && duration < 350) {
            toggleFlip();
          }
          card.classList.remove("zoomed");
        };

        card.addEventListener("touchstart", onStart, { passive: false });
        card.addEventListener("touchmove", onMove, { passive: false });
        card.addEventListener("touchend", onEnd);
        card.addEventListener("mousedown", onStart);
        document.addEventListener("mousemove", (e) => {
          if (e.buttons === 1 && card.style.zIndex == highestZ) onMove(e);
        });
        document.addEventListener("mouseup", onEnd);
      }
    </script>
  </body>
</html>
